---
title: "Untitled"
author: "Woo"
date: "05/06/2021"
output: 
  pdf_document:
  dev: cairo_pdf
  extra_dependencies:
      setspace: null
      xcolor: null
      tikz: null
      graphicx: null
      changepage: null
---

```{r setup2, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(grid)
library(dvir)
source("./Appendices/algorithms.R")
testText <- c("test",
              "testing",
              "var",
              "varying",
              "$\\sum_{n=1}^{\\infty} 2^{-n} = 1$",
              "$\\sum\\limits_{n=1}^{\\infty} 2^{-n} = 1$",
              "$\\sum\\limits_{n=1}^{} 2^{-n} = 1$",
              "The equation is $x + \\frac{\\mu^2}{2}$",
              "The equation is $x + \\frac{\\mu}{2}$",
              "$\\frac{\\mu^2}{2} + x$ is the equation",
              "$x + \\frac{\\mu}{2}$ is the equation",
              "\\begin{minipage}{1in}Paragraph, with some line wrapping!\\end{minipage}")

# Function to convert 'grid' units to LaTeX units (changing the characters at the end basically)
unitConvert <- function(x) {
  paste0(as.numeric(x), switch(attr(x, "unit"),
                               scaledpts = "sp",
                               inches = "in",
                               points = "pt",
                               attr(x, "unit")))
}

baselineFunc <- function(testText, 
                         algo, 
                         caption, 
                         dviMovesMethod = "all", 
                         dviMovesSelection = 1) {
  algorithmBaselines <- list()
  for (i in seq_along(testText)) {
    algorithmBaselines[[i]] <- baselines(tex = testText[i],
                                         algorithm = algo,
                                         dviMovesMethod = dviMovesMethod,
                                         dviMovesSelection = dviMovesSelection)
  }
  
  
  latexCode <- character(0)
  baselineEnviroHead <- paste0("\\begin{figure}\n",
                              "\\begin{adjustwidth}{0.5in}{0in}\n")
  baselineEnviroFoot <- paste0("\\end{adjustwidth}\n",
                               "\\caption{",
                               caption,
                               "}\n",
                               "\\end{figure}")
  latexCode <- baselineEnviroHead
  for (i in seq_along(algorithmBaselines)) {
    latexCode <- c(latexCode, 
                   paste("\\boxreport{", 
                         testText[i], 
                         "}{", 
                         unitConvert(algorithmBaselines[[i]][1]), 
                         "}\n", 
                         sep = ""))
    if (length(algorithmBaselines[[i]]) > 1) {
      for (j in 2:length(algorithmBaselines[[i]])) {
        latexCode <- c(latexCode, 
                       paste("\\boxpersist{", 
                             unitConvert(algorithmBaselines[[i]][j]), 
                             "}\n", 
                             sep = ""))
      }
    }
    latexCode <- c(latexCode, "\\vspace{0.3cm}\n")
  }
  latexCode <- c(latexCode, baselineEnviroFoot)
  # latexCode
}


```


\newsavebox{\dvibox}
\newlength{\dviwidth}

\newcommand{\boxreport}[2]{%
  \sbox{\dvibox}{\parbox[b]{2in}{#1}}% Change width to be '1in' if going back to better way of doing it. Better yet, get variable that takes width of text itself (like TeX examples from Paul) 
  \settowidth {\dviwidth} {\usebox{\dvibox}}%
  \usebox{\dvibox}%
  \vspace{-#2}%
  \hrule width \dviwidth \relax
  \vspace{#2}%
}

\newcommand{\boxpersist}[1]{%
  \vspace{-#1}
  \hrule width \dviwidth \relax
  \vspace{#1}%
}

```{r}
dviMovesLatex <- baselineFunc(testText, "dviMoves", "Using the \\texttt{dviMoves} algorithm to calculate the baselines.")
# cat(dviMovesLatex)
```

```{r}
algorithmBaselines <- unit(0, "cm")
    algorithmBaselines <- unit.c(algorithmBaselines, 
                                 baselines(tex = testText[12],
                                        algorithm = "dviMoves",
                                        dviMovesMethod = "all",
                                        dviMovesSelection = dviMovesSelection))

  latexCode <- character(0)
  baselineEnviroHead <- paste0("\\begin{figure}\n")
  baselineEnviroFoot <- paste0("\\end{figure}")
  latexCode <- baselineEnviroHead
  for (i in seq_along(algorithmBaselines)) {
    latexCode <- c(latexCode, 
                   paste("\\boxreport{", 
                         testText[12], 
                         "}{", 
                         unitConvert(algorithmBaselines[i]), 
                         "}\n\\vspace{0.3cm}\n", 
                         sep = ""))
    
    # latexCode <- c(latexCode, "\\vspace{0.3cm}\n")
  }
  latexCode <- c(latexCode, baselineEnviroFoot)
  

```

```{r results = "asis", include = TRUE}
cat(latexCode)
```


```{r}
algorithmBaselines <- unit(0, "cm")
    algorithmBaselines <- unit.c(algorithmBaselines, 
                                 baselines(tex = testText[12],
                                        algorithm = "dviMoves",
                                        dviMovesMethod = "all",
                                        dviMovesSelection = dviMovesSelection))

  latexCode <- character(0)
  baselineEnviroHead <- paste0("\\begin{spacing}{1.5}\n")
  baselineEnviroFoot <- paste0("\\end{spacing}")
  latexCode <- baselineEnviroHead
  for (i in seq_along(algorithmBaselines)) {
    latexCode <- c(latexCode, 
                   paste("\\boxreport{", 
                         testText[12], 
                         "}{", 
                         unitConvert(algorithmBaselines[i]), 
                         "}\n\\vspace{0.3cm}\n", 
                         sep = ""))
    
    # latexCode <- c(latexCode, "\\vspace{0.3cm}\n")
  }
  latexCode <- c(latexCode, baselineEnviroFoot)
  

```

```{r results = "asis", include = TRUE}
cat(latexCode)
```
